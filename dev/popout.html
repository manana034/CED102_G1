<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script>

    <style>
        /* .r-btn.add_fd_btn{
            
        } */
        .add_fd_btn, .add_fd_btn_2{ 
            background-color: #9F1600;
        }
        .fd_input_form{
            box-sizing: border-box!important;
            width:450px;
            height:480px;
            background:#fdfdfd;
            border: 1px solid #C9C9C9;
            position: absolute;
            top: -600px;
            left: calc( 50% - 400px);
            padding: 30px;
        }
        .fd_input_date{
            display:flex;
        }
        .fd_input_date input{
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fdfdfd;
            padding: 2px;
            cursor: pointer;
            color: #666666;
            font-weight: bold;
        }
        .fd_input_date p{
            font-size: 14px;
        }
        .meal_select{
            margin-top: 10px;
            text-align: left;
        }
        .meal_select img,.meal_select select{
            vertical-align: middle;
        }
        .meal_select select{
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fdfdfd;
            padding: 2px;
            cursor: pointer;
            color: #666666;
            font-size: 16px;
        }
     /* ------------動態新增------------------- */
     .add_meal input{
            height: 30px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fdfdfd;
            padding: 2px;
            cursor: pointer;
            color: #666666;
            margin-top: 10px;
            text-align: center;
            font-size: 16px;
     }
     .fd_input_date  button{
         
        border: none;
         background-color: unset;
         cursor: pointer;
         outline: unset;
         margin-left: 15%;
     }
     .add_meal button{
         border: none;
         background-color: #fdfdfd;
         cursor: pointer;
         outline: unset;
     }
     .add_meal button img{
         width: 18px;
        vertical-align: middle;
        margin-bottom: 4px;
     }
     .add_food_select{
         display: grid;
         grid-template-columns: 40% 20% 30% 10%;
     }
     .food_select_tilte{
         margin-top: 10px;
         display: grid;
         grid-template-columns:33% 32% 15%;
         color: #666666;
         font-weight: bold;
         font-size: 14px;
     }
     .food_select_tilte span{
         text-align: center;
     }
     .add_food_select select,.add_food_select input,.add_food_select span{
            width: 90%;
            border: 1px solid #ddd;
            border-radius: 20px;
            background-color: #fdfdfd;
            padding: 2px;
            cursor: pointer;
            color: #666666;
            margin-top: 5px;
            padding:10px 0px 10px 0px;
            text-align: center;
            text-align-last: center;
            font-size: 16px;
     }
     .add_food_select ul{
        margin-top: 10px;
        width: 400px;
        height:225px;
        list-style: none;
        overflow: scroll;
        border-bottom: 1px solid #C9C9C9;
     }
     .add_food_select ul li{
       display: grid;
       padding: 2px 0px 2px 0px;
       grid-template-columns: 40% 20% 30% 10%;
     }
     .add_food_select  button{
         border: none;
         margin-top: 8px;
         cursor: pointer;
         outline: none;
         background-color: #fdfdfd;
     }
   
     ::-webkit-scrollbar-track,::-webkit-scrollbar-corner{
         background-color: unset;
     }
     .add_fd_btn_2{
         width: 30%;
         /* margin-left: 30%; */
         margin-top: 15px;
     }
    </style>
</head>
<body>
    <div id="app2"> 
        <button class="r-btn add_fd_btn" v-show="true" @click="open">Add Food</button>
        <div class="card fd_input_form" v-show="!isShow">
            <div class="fd_input_date">
               <p>Your Food Diary For :</p>
               <input type="date" class="bookdate" id="bookdate" v-model="selecteddate" @change="checkdate">
               <button @click="close"><img src="./img/del_icon.svg"></button>
            </div>
            <div class="meal_select">
                <img src="./img/cup_icon.svg">
                <select>
                    <option>Breakfast</option>
                    <option>Lunch</option>
                    <option>Dinner</option>
                </select>
            </div>
            <div class="food_select_tilte">
                <span>FOOD</span>
                <span>QTY</span>
                <span>CAL</span>
            </div>
            <div class="add_food_select">
                <select v-model="fruit">
                    <!-- <option disabled value="0">Select Food</option> -->
                    <option 
                        v-for="list in foods" 
                        v-bind:value="list.fdid" 
                        >
                        {{list.fdname}}
                    </option>
                </select>
                <input v-model="newAdd_number" oninput = "value=value.replace(/[^\d]/g,'')" placeholder=""/>
                <span >{{foods[fruit-1].fdcal*newAdd_number}}</span>
                <button @click='addNewList_1'><img src="./img/add_icon.svg"></button>
                <!-- 動態新增項目 -->
            
                <ul>
                    <li v-for='(list,index) in lists' v-bind:key='list.id'>
                        <span> {{foods[list.food_id-1].fdname}}</span>
                        <input v-model="list.number" oninput = "value=value.replace(/[^\d]/g,'')" placeholder=""/>
                        <span>{{foods[list.food_id-1].fdcal*list.number}}</span>
                        <button v-on:click='lists.splice(index, 1)'>
                            <img src="./img/del_icon.svg">
                        </button>
                    </li>
                </ul>
                
            </div>
            <button class="r-btn add_fd_btn_2">Add</button>
        </div>
    </div>
    <script>
    const  inputfoodV = new Vue({
        el: '#app2',
        data: {
            selecteddate:"",
            todaydatesave:"",
            datesave:"",
            fruit: 1,
            isShow: true,
            newAdd_number:'1',
            newAddText:'1',
            newAddCal:'1',
            newAdd_fdname:'',
            lists:[],
            nextTodoId: 0,
            foods:[
              { fdid:0,fdname:'Hamberger', fdcal:250}
            //   { fdid:1,fdname:'Sandwich', fdcal:150},
            //   { fdid:2,fdname:'French fries', fdcal:180},
            //   { fdid:3,fdname:'Pasta', fdcal:220},
            //   { fdid:4,fdname:'Steak', fdcal:300},
            //   { fdid:5,fdname:'Cake', fdcal:155},
            //   { fdid:6,fdname:'Bear', fdcal:95},
            //   { fdid:7,fdname:'Milk tea', fdcal:90},
            //   { fdid:8,fdname:'Cola', fdcal:120}
            ],
        },
        methods:{
          
            close(){
            this.isShow=! this.isShow
            },
            open(){
            this.isShow=! this.isShow
            },
            checkdate:function(){
                if(Date.parse(this.selecteddate) > Date.parse(this.todaydatesave)){
                    alert("Please select a correct date!");
                    this.selecteddate=this.datesave;
                }else{
                    this.datesave=this.selecteddate;
                    changedate2();
                }
            },
            addNewList_1:function(){
                this.lists.push({
                    fdid:this.nextTodoId++,
                    number:this.newAdd_number,
                    food_id:this.fruit
                })
                this.newAdd_number='1'
            },
            addNewList:function(){
                this.lists.push({
                    fdid:this.nextTodoId++,
                    title:this.newAddText,
                    fdcal:this.newAddCal
                })
                this.newAddText='1',
                this.newAddCal='1'
            },
           
               
        }    
    })
    </script>
    <script>
        function getProducts(){
            let xhr = new XMLHttpRequest();
            xhr.onload = function(){
                prodRows = JSON.parse(xhr.responseText);
                // console.log(prodRows);
                inputfoodV.foods = prodRows;
                foodrecordchange.foods=prodRows;
            }
            xhr.open("get", "./php/getMore2_JSON.php", true);
            xhr.send(null);
        }
        window.addEventListener("load", function(){
            //-----------------使用ajax 回server端取回資料
            getProducts();
        })
    </script>   
</body>
</html>