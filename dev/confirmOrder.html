<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" type="text/css" href="./css/common/confirmOrder.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.12/vue.min.js"></script>
    <script src="./js/header.js" defer></script>
    <title>Confirm Order</title>
</head>
<body>
    <div class="headerContainer">
        @@include('./layout/header.html')
        @@include('./layout/cart.html')
    </div>  
    <div class="cartall" id="app">
         <h5>MY CART</h5>
         <div class="steps">
             <p>1. CHECK ORDER</p>
             <p>2. PAYMENT</p>
             <p>3. CONFIRM ORDER</p>
         </div>
         
         <!-- order -->
         <div class="orderall">
            <div class="confirmorder">
                <h6>Thanks for your order!</h6>
                <p>Your order number is <a href="./member.html">{{final[0].orderNo}}</a>. </p>
                <p>Confirmation email has sent to your email:{{email}}.</p>
                <p>We will deliver the goods within a period of 5–7 day. </p>
            </div>

            <table class="orderinfo">
                <tr>
                    <th>PRODUCT</th>
                    <th>QTY</th>
                    <th>PRICE</th>
                    <th>DELETE</th>
                </tr>
                <tr v-for="order in final">
                    <td class="order">
                        <a :href="'./product.html?id=' + order.prodNo" @click="setId" :data-no="order.prodNo">
                            <img :src="order.prodPic1">
                            <p>ALMONDS BAR</p>
                        </a>
                    </td>
                        <td>{{order.quantity}}</td> 
                        <td>NT${{order.price}}</td> 
                        <td>&times;</td> 
                    </tr>    
            </table>
            
            <div class="subtotal">
                <p>SUBTOTAL</p>
                <p>NT${{subtotal}}</p>
                <p>SHIPPING</p>
                <p>NT$ 0 </p>
                <p>POINTS</p>
                <p>- NT${{final[0].usePoints}}</p>
                <h6>TOTAL : {{final[0].total}}</h6>
            </div>
        </div>

         <div class="back">
            <a href="./shop.html"> &lt; BACK TO SHOP</a>
        </div>
    </div>
     @@include('./layout/footer.html')
     
    <script src="./js/cart.js"></script>
    <script src="./js/header_customSelect.js" defer></script>
    <script>
        let vm = new Vue({
            el: "#app",
            data:{
                final:[],
                email:""
            },
            computed:{
                subtotal(){
                    return parseInt(this.final[0].total) + parseInt(this.final[0].usePoints);
                }
            },
            methods:{
                setId(e){
                    sessionStorage.setItem("no", e.target.parentNode.dataset.no)
                }
            },
            mounted(){
                this.final = JSON.parse(sessionStorage.getItem("finalOrder"));
                
                function checkMem(){
                    let vThis = this;
                    let xhr = new XMLHttpRequest;
                    xhr.onload = () => {
                        //將獲取 id 或是 "{}"
                        console.log(xhr.responseText)
                        member = JSON.parse(xhr.responseText)
                        if (member.mNo || member.mId || member.mPsw) {
                            vThis.email = member.mMail;
                            console.log(vThis.email);
                        }else{
                            console.log("notwork");
                        }
                    }
                    xhr.open('get', './php/checkLoggedin.php', true)
                    xhr.send(null)
                }
                checkMem();
            }
        })
    </script>
   
</body>
</html>